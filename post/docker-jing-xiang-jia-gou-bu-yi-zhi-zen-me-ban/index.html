<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>Dockeré•œåƒæ¶æ„ä¸ä¸€è‡´æ€ä¹ˆåŠ | å’•å’•å’•çš„åšå®¢</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous"> -->
<link href="https://cdn.bootcss.com/font-awesome/5.13.0/css/all.css" rel="stylesheet">
<link rel="shortcut icon" href="https://dove-gugugu.github.io//favicon.ico?v=1716523516598">
<link rel="stylesheet" href="https://dove-gugugu.github.io//styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<!-- <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script> -->
<script src="https://cdn.jsdelivr.net/npm/vue@2.7.16"></script>



    <meta name="description" content="å½“é•œåƒçš„æ¶æ„ä¸æœåŠ¡å™¨æ¶æ„ä¸ä¸€è‡´æ—¶ï¼Œå¯ä»¥é‡‡ç”¨å°†æ­£å¸¸è¿è¡Œçš„å®¹å™¨æ‰“åŒ…æˆæ–°é•œåƒçš„æ–¹æ³•

DockerÂ buildx æ„å»ºå¤šæ¶æ„é•œåƒ
è¯¦è§è¿™é‡Œ
docker buildx build --platform linux/arm64 -t discuz/..." />
    <meta name="keywords" content="Docker" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://dove-gugugu.github.io/">
        <img src="https://dove-gugugu.github.io//images/avatar.png?v=1716523516598" class="site-logo">
        <h1 class="site-title">å’•å’•å’•çš„åšå®¢</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      <!-- æ–°å¢æœç´¢æ¡† -->
      <form id="gridea-search-form" style="position: relative" data-update="1716523516598" action="/search/">
        <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="æœç´¢æ–‡ç« " />
        <!-- <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i> -->
      </form>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <!-- æ–°å¢å¤©æ°”æ¨¡å— -->
    <div class="weather-info">
      <div class="weather-temperature"></div>
      <div class="weather-details">
        <div class="weather-city"></div>
        <div class="weather-condition"></div>
      </div>
    </div>
    <div class="site-description">
      æ¸©æ•…è€ŒçŸ¥æ–°
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://dove-gugugu.github.io//atom.xml" target="_blank">RSS</a>
    </div>
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/dove-gugugu" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
          <a class="social-link" href="https://qm.qq.com/q/Ct9sVdkvo" target="_blank">
            <i class="fab fa-qq"></i>
          </a>
        
      
        
      
        
      
        
      
        
      
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">Dockeré•œåƒæ¶æ„ä¸ä¸€è‡´æ€ä¹ˆåŠ</h2>
            <div class="post-date">
              2024-05-21
              <span style="margin-left: 10px;">å­—æ•°ï¼š970</span>
              <span style="margin-left: 10px;">é˜…è¯»æ—¶é—´ï¼š4åˆ†é’Ÿå·¦å³</span>
            </div>
            
              <div class="tag-container">
                
                  <a href="https://dove-gugugu.github.io/tag/_Bs_92vmT/" class="tag">
                    Docker
                  </a>
                
              </div>
            
            
              <div class="feature-container" style="background-image: url('https://wallpaperaccess.com/full/2982328.jpg')">
              </div>
            
            <div class="toc-container">
              <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#docker-buildx-%E6%9E%84%E5%BB%BA%E5%A4%9A%E6%9E%B6%E6%9E%84%E9%95%9C%E5%83%8F">DockerÂ buildx æ„å»ºå¤šæ¶æ„é•œåƒ</a></li>
<li><a href="#%E5%BC%80%E5%90%AF-binfmt_misc-%E6%9D%A5%E8%BF%90%E8%A1%8C%E9%9D%9E%E6%9C%AC%E5%9C%B0%E6%9E%B6%E6%9E%84-docker-%E9%95%9C%E5%83%8F">å¼€å¯ binfmt_misc æ¥è¿è¡Œéæœ¬åœ°æ¶æ„ Docker é•œåƒ</a><br>
*
<ul>
<li><a href="#%E9%85%8D%E7%BD%AE-binfmt_misc">é…ç½® binfmt_misc</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </div>
            <div class="post-content" v-pre>
              <p>å½“é•œåƒçš„æ¶æ„ä¸æœåŠ¡å™¨æ¶æ„ä¸ä¸€è‡´æ—¶ï¼Œå¯ä»¥é‡‡ç”¨å°†æ­£å¸¸è¿è¡Œçš„å®¹å™¨æ‰“åŒ…æˆæ–°é•œåƒçš„æ–¹æ³•</p>
<!-- more -->
<h2 id="docker-buildx-æ„å»ºå¤šæ¶æ„é•œåƒ">DockerÂ buildx æ„å»ºå¤šæ¶æ„é•œåƒ</h2>
<p>è¯¦è§<a href="https://blog.csdn.net/Canger_/article/details/122239139">è¿™é‡Œ</a></p>
<p>docker buildx build --platform linux/arm64 -t discuz/test-for-buildx . --load</p>
<h2 id="å¼€å¯-binfmt_misc-æ¥è¿è¡Œéæœ¬åœ°æ¶æ„-docker-é•œåƒ">å¼€å¯ binfmt_misc æ¥è¿è¡Œéæœ¬åœ°æ¶æ„ Docker é•œåƒ</h2>
<p>è¯¦è§<a href="https://blog.csdn.net/WZP_LOVE/article/details/121443240">è¿™é‡Œ</a></p>
<p>å¯ç”¨Â <code>binfmt_misc</code> ï¼šè¿è¡Œä¸€ä¸ªç‰¹æƒå®¹å™¨ï¼Œå®¹å™¨é‡Œé¢å†™å¥½äº†è®¾ç½®è„šæœ¬</p>
<p>ä½¿ç”¨Dockeré•œåƒå®‰è£…æ¨¡æ‹Ÿå™¨ï¼š <a href="https://hub.docker.com/r/tonistiigi/binfmt">tonistiigi/binfmt</a></p>
<pre><code class="language-bash">docker run --privileged --rm tonistiigi/binfmt --install all
</code></pre>
<ul>
<li><strong>Linux kernel &gt;= 4.8</strong>: è‡ªè¯¥Linuxå†…æ ¸ç‰ˆæœ¬ binfmt_misc æ”¯æŒ fix-binary (F) flagã€‚fix_binary æ ‡å¿—å…è®¸å†…æ ¸åœ¨å®¹å™¨æˆ–chrootå†…ä½¿ç”¨binfmt_miscæ³¨å†Œçš„äºŒè¿›åˆ¶æ ¼å¼å¤„ç†ç¨‹åºï¼Œå³ä½¿è¯¥å¤„ç†ç¨‹åºäºŒè¿›åˆ¶æ–‡ä»¶ä¸æ˜¯è¯¥å®¹å™¨æˆ–chrootå†…å¯è§çš„æ–‡ä»¶ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚</li>
<li><strong>binfmt_misc file system mounted</strong>: éœ€è¦æŒ‚è½½binfmt_miscæ–‡ä»¶ç³»ç»Ÿï¼Œä»¥ä¾¿ç”¨æˆ·ç©ºé—´å·¥å…·å¯ä»¥æ§åˆ¶æ­¤å†…æ ¸åŠŸèƒ½ï¼Œå³æ³¨å†Œå’Œå¯ç”¨å¤„ç†ç¨‹åºã€‚</li>
</ul>
<h4 id="é…ç½®-binfmt_misc">é…ç½® binfmt_misc</h4>
<p>QEMU æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„å¼€æºé¡¹ç›®ï¼Œå®ƒå¯ä»¥æ¨¡æ‹Ÿå¾ˆå¤šå¹³å°ã€‚å°† QEMU å’Œ Docker ç»“åˆèµ·æ¥ä½¿ç”¨èƒ½ä½¿å¾—æˆ‘ä»¬æ›´å®¹æ˜“çš„æ„å»ºè·¨å¹³å°çš„å®¹å™¨é•œåƒã€‚é›†æˆ QEMUä¾èµ–äº Linux å†…æ ¸åŠŸèƒ½ ã€‚Linux å†…æ ¸ä¸­çš„Â <code>binfmt_misc</code>åŠŸèƒ½å¯ä»¥ä½¿å¾—å†…æ ¸è¯†åˆ«ä»»æ„ç±»å‹çš„å¯ä»¥æ‰§è¡Œæ–‡ä»¶æ ¼å¼ï¼Œå¹¶ä¼ é€’åˆ°ç‰¹å®šçš„ç”¨æˆ·ç©ºé—´åº”ç”¨ç¨‹åºå’Œè™šæ‹Ÿæœºï¼ˆ<a href="https://zh.wikipedia.org/wiki/Binfmt_misc%EF%BC%89%E3%80%82%E5%BD%93">https://zh.wikipedia.org/wiki/Binfmt_miscï¼‰ã€‚å½“</a>Â Linux é‡åˆ°ä¸€ç§æ— æ³•è¯†åˆ«çš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ï¼ˆæ¯”å¦‚è¯´å…¶å®ƒå¹³å°çš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ï¼‰æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥æœ‰æ²¡æœ‰é…ç½®ä»»ä½•â€œç”¨æˆ·ç©ºé—´åº”ç”¨ç¨‹åºâ€ç”¨äºå¤„ç†å®ƒã€‚å¦‚æœæ£€æµ‹åˆ°äº†ï¼Œå°±å°†å¯æ‰§è¡Œæ–‡ä»¶ä¼ é€’ç»™è¯¥åº”ç”¨ç¨‹åºã€‚</p>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å†…æ ¸å½“ä¸­æ³¨å†Œå…¶å®ƒå¹³å°çš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ã€‚</p>
<p>å¯¹äºä½¿ç”¨ Docker Desktopï¼ˆMacOS å’Œ Windows ä¸Šéƒ½æ˜¯ï¼‰çš„åŒå­¦ï¼Œå› ä¸ºé»˜è®¤é…ç½®äº†Â <code>binfmt_misc</code>ï¼Œå¯ä»¥è·³è¿‡è¿™ä¸€æ­¥ã€‚è€Œä½¿ç”¨ Linux å‘è¡Œç‰ˆæ“ä½œç³»ç»Ÿçš„åŒå­¦åˆ™éœ€è¦è‡ªè¡Œå®‰è£…é…ç½®Â <code>binfmt_misc</code>ï¼Œä»¥ä¾¿èƒ½å¤ŸéåŸç”Ÿçš„å…¶å®ƒå¹³å°çš„é•œåƒã€‚</p>
<p>è¦åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œå…¶å®ƒ CPU å¹³å°çš„æŒ‡ä»¤ï¼Œéœ€è¦å®‰è£… QEMU æ¨¡æ‹Ÿå™¨ã€‚å› ä¸ºç¨‹åºæ‰§è¡Œæ—¶ä¼šåœ¨å½“å‰ç¨‹åºå¯è§çš„æ–‡ä»¶ç³»ç»Ÿä¸­æŸ¥æ‰¾åŠ¨æ€åº“ï¼Œè€Œåœ¨å®¹å™¨æˆ–chrootç¯å¢ƒä¸­æ³¨å†Œçš„å¤„ç†ç¨‹åºåœ¨å…¶å®ƒçš„ cgroup namespace ä¸­å¯èƒ½æ— æ³•æ‰¾åˆ°ï¼Œæ‰€ä»¥éœ€è¦é™æ€ç¼–è¯‘è¿æ¥çš„QEMUã€‚åŒæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…ä¸€ä¸ªåŒ…å«è¶³å¤Ÿæ–°çš„update-binfmtsäºŒè¿›åˆ¶æ–‡ä»¶çš„åŒ…ï¼Œä»¥ä¾¿èƒ½å¤Ÿæ”¯æŒfix-binaryï¼ˆFï¼‰æ ‡å¿—ï¼Œå¹¶åœ¨æ³¨å†ŒQEMUæ¨¡æ‹Ÿå™¨æ—¶å®é™…ä½¿ç”¨ï¼Œè¿™æ ·æ‰èƒ½ç»“åˆ buildx ä¸€èµ·é•œåƒè·¨å¹³å°æ„å»ºã€‚</p>
<p>QEMU å’Œ binfmt_misc æ”¯æŒå·¥å…·å¯ä»¥é€šè¿‡<strong>å®¿ä¸»æœº</strong>æˆ–è€…<strong>Docker å®¹å™¨é•œåƒ</strong>å®‰è£…ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨Dockeré•œåƒå®‰è£…é…ç½®èƒ½è®©äº‹æƒ…å˜å¾—æ›´åŠ ç®€å•ã€‚é•œåƒÂ <code>docker/binfmt</code>Â ä¸­åŒ…å«QEMUäºŒè¿›åˆ¶æ–‡ä»¶å’Œåœ¨binfmt_miscä¸­æ³¨å†ŒQEMUçš„å®‰è£…è„šæœ¬ã€‚</p>
<pre><code class="language-dockerfile">docker run --privileged docker/binfmt:66f9012c56a8316f9244ffd7622d7c21c1f6f28d
</code></pre>
<p>æ‰§è¡Œå®Œåï¼Œæˆ‘ä»¬éªŒè¯ä¸‹æ˜¯å¦æ³¨å†ŒæˆåŠŸäº†ã€‚æˆåŠŸæ³¨å†Œåï¼Œ<code>/proc/sys/fs/binfmt_misc</code>Â ç›®å½•ä¸­ä¼šæœ‰å¤šä¸ª<code>qemu-</code>å‰ç¼€çš„æ–‡ä»¶ã€‚æŸ¥çœ‹Â <code>/proc/sys/fs/binfmt_misc/qemu-aarch64</code>Â æ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥çœ‹åˆ° falgs æ ‡å¿—ä¸ºÂ <code>OCF</code>ï¼Œè¯´æ˜è¿™ä¸ªå¤„ç†ç¨‹åºæ˜¯é€šè¿‡ ï¼ˆFï¼‰æ ‡å¿—æ³¨å†Œçš„ï¼Œèƒ½å¤Ÿæ­£å¸¸çš„ç»“åˆ buildx å®Œæˆè·¨å¹³å°æ„å»ºã€‚</p>
<p><a href="https://www.cnblogs.com/tencent-cloud-native/p/14190655.html">å¤šå¹³å°å®¹å™¨é•œåƒæ„å»ºå°±çœ‹è¿™ä¸€ç¯‡</a><br>
<a href="www.cnblogs.com/frankming/p/16870285.html">å®¹å™¨é•œåƒå¤šæ¶æ„æ”¯æŒä»‹ç»</a></p>
<p><a href="https://docs.docker.com/build/building/multi-platform/#support-on-docker-desktop">dockerå®˜ç½‘ä¸­å¤šå¹³å°é•œåƒçš„å†…å®¹</a></p>
<p>ğŸ‘‡<br>
Docker Desktopæä¾›äº†binfmt_miscå¤šæ¶æ„æ”¯æŒï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥ä¸ºä¸åŒçš„Linuxæ¶æ„(å¦‚armã€mipsã€ppc64leï¼Œç”šè‡³s390x)è¿è¡Œå®¹å™¨ã€‚</p>
<p>è¿™å¹¶ä¸éœ€è¦å®¹å™¨æœ¬èº«çš„ä»»ä½•ç‰¹æ®Šé…ç½®ï¼Œå› ä¸ºå®ƒä½¿ç”¨äº†æ¥è‡ªDocker for Mac VMçš„qemu-staticã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥è¿è¡ŒARMå®¹å™¨ï¼Œä¾‹å¦‚busyboxæ˜ åƒçš„arm32v7æˆ–ppc64leå˜ä½“ã€‚</p>

            </div>
            <!-- 
              <div class="tag-container">
                
                  <a href="https://dove-gugugu.github.io/tag/_Bs_92vmT/" class="tag">
                    Docker
                  </a>
                
              </div>
             -->
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://dove-gugugu.github.io/post/mysql-zhu-cong-fu-zhi-de-pei-zhi-bu-zou/">
                  <h3 class="post-title">
                    MySQLä¸»ä»å¤åˆ¶çš„é…ç½®æ­¥éª¤
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>




<script>
  // è·å–ä¸€è¨€apiæ•°æ®å¹¶æ›´æ–°description divæ ‡ç­¾çš„æ–‡æœ¬å†…å®¹å’Œmetaæ ‡ç­¾çš„contentå†…å®¹
  fetch('https://v1.hitokoto.cn/?c=d&c=i&encode=text')
    .then(response => response.text())
    .then(data => {
      // æ›´æ–°description divæ ‡ç­¾çš„æ–‡æœ¬å†…å®¹
      document.getElementsByClassName('site-description')[0].innerText = data;
      // æ›´æ–°metaæ ‡ç­¾çš„contentå†…å®¹
      document.querySelector('meta[name=description]').setAttribute('content', data);
    })
    .catch(error => {
      console.error('è®¿é—®ä¸€è¨€apiå‘ç”Ÿé”™è¯¯:', error);
    });
  function updateWeatherInfo(city, weather, temperature) {
    // ä½¿ç”¨è·å–åˆ°çš„æ•°æ®æ›´æ–°DOM
    document.querySelector('.weather-city').textContent = `${city}`;
    document.querySelector('.weather-condition').textContent = `${weather}`;
    document.querySelector('.weather-temperature').textContent = `${temperature}Â°C`;
  }
  // ä½¿ç”¨fetchå‡½æ•°å‘é€GETè¯·æ±‚åˆ°API
  fetch('https://05d001686f8e43249d001efa0d32a2a3.apig.cn-south-1.huaweicloudapis.com/weather')
    .then(response => {
      // æ£€æŸ¥å“åº”çŠ¶æ€æ˜¯å¦æˆåŠŸ
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      // å°†å“åº”ä½“è½¬æ¢ä¸ºJSONæ ¼å¼
      return response.json();
    })
    .then(data => {
      // æå–æ‰€éœ€çš„æ•°æ®å¹¶æ‰“å°
      const { city, weather, temperature } = data;
      updateWeatherInfo(city, weather, temperature);
    })
    .catch(error => {
      // æ‰“å°é”™è¯¯ä¿¡æ¯
      console.error('There has been a problem with your fetch operation:', error);
    });
</script>


  <style>
    .toc-container {
      position: fixed;
      top: 50px;
      /* Adjust depending on your layout */
      right: 20px;
      /* Adjust depending on your layout */
      width: 200px;
      padding: 16px 8px;
      background-color: #fff;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .toc-container .markdownIt-TOC {
      position: sticky;
      top: 0;
      font-size: 12px;
      list-style: none;
      padding-left: 0;
    }

    .toc-container .markdownIt-TOC:before {
      content: "";
      position: absolute;
      top: 0;
      left: 8px;
      bottom: 0;
      width: 1px;
      background-color: #ebedef;
      opacity: 0.5;
    }

    .toc-container ul {
      list-style: none;
      padding: 0;
    }

    .toc-container li {
      padding-left: 16px;
    }

    .toc-container li a {
      color: #444444;
      padding: 8px;
      display: block;
      transition: all 0.3s;
    }

    .toc-container li a:hover {
      background: #fafafa;
    }

    .toc-container li a.current {
      background: #fafafa;
    }

    @media (max-width: 1150px) {
      .toc-container {
        display: none;
      }
    }
  </style>
  </body>
</html>
